#include <pybind11/pybind11.h>

#include "llama-model.h"

namespace py = pybind11;

PYBIND11_MODULE(llama_model, m) {
    py::enum_<llm_type>(m, "llm_type")
        .value("LLM_TYPE_UNKNOWN", llm_type::LLM_TYPE_UNKNOWN)
        .value("LLM_TYPE_14M", llm_type::LLM_TYPE_14M)
        .value("LLM_TYPE_17M", llm_type::LLM_TYPE_17M)
        .value("LLM_TYPE_22M", llm_type::LLM_TYPE_22M)
        .value("LLM_TYPE_33M", llm_type::LLM_TYPE_33M)
        .value("LLM_TYPE_60M", llm_type::LLM_TYPE_60M)
        .value("LLM_TYPE_70M", llm_type::LLM_TYPE_70M)
        .value("LLM_TYPE_80M", llm_type::LLM_TYPE_80M)
        .value("LLM_TYPE_109M", llm_type::LLM_TYPE_109M)
        .value("LLM_TYPE_137M", llm_type::LLM_TYPE_137M)
        .value("LLM_TYPE_160M", llm_type::LLM_TYPE_160M)
        .value("LLM_TYPE_190M", llm_type::LLM_TYPE_190M)
        .value("LLM_TYPE_220M", llm_type::LLM_TYPE_220M)
        .value("LLM_TYPE_250M", llm_type::LLM_TYPE_250M)
        .value("LLM_TYPE_270M", llm_type::LLM_TYPE_270M)
        .value("LLM_TYPE_335M", llm_type::LLM_TYPE_335M)
        .value("LLM_TYPE_410M", llm_type::LLM_TYPE_410M)
        .value("LLM_TYPE_450M", llm_type::LLM_TYPE_450M)
        .value("LLM_TYPE_770M", llm_type::LLM_TYPE_770M)
        .value("LLM_TYPE_780M", llm_type::LLM_TYPE_780M)
        .value("LLM_TYPE_0_5B", llm_type::LLM_TYPE_0_5B)
        .value("LLM_TYPE_1B", llm_type::LLM_TYPE_1B)
        .value("LLM_TYPE_1_3B", llm_type::LLM_TYPE_1_3B)
        .value("LLM_TYPE_1_4B", llm_type::LLM_TYPE_1_4B)
        .value("LLM_TYPE_1_5B", llm_type::LLM_TYPE_1_5B)
        .value("LLM_TYPE_1_6B", llm_type::LLM_TYPE_1_6B)
        .value("LLM_TYPE_1_8B", llm_type::LLM_TYPE_1_8B)
        .value("LLM_TYPE_2B", llm_type::LLM_TYPE_2B)
        .value("LLM_TYPE_2_8B", llm_type::LLM_TYPE_2_8B)
        .value("LLM_TYPE_2_9B", llm_type::LLM_TYPE_2_9B)
        .value("LLM_TYPE_3B", llm_type::LLM_TYPE_3B)
        .value("LLM_TYPE_4B", llm_type::LLM_TYPE_4B)
        .value("LLM_TYPE_6B", llm_type::LLM_TYPE_6B)
        .value("LLM_TYPE_6_9B", llm_type::LLM_TYPE_6_9B)
        .value("LLM_TYPE_7B", llm_type::LLM_TYPE_7B)
        .value("LLM_TYPE_8B", llm_type::LLM_TYPE_8B)
        .value("LLM_TYPE_9B", llm_type::LLM_TYPE_9B)
        .value("LLM_TYPE_11B", llm_type::LLM_TYPE_11B)
        .value("LLM_TYPE_12B", llm_type::LLM_TYPE_12B)
        .value("LLM_TYPE_13B", llm_type::LLM_TYPE_13B)
        .value("LLM_TYPE_14B", llm_type::LLM_TYPE_14B)
        .value("LLM_TYPE_15B", llm_type::LLM_TYPE_15B)
        .value("LLM_TYPE_16B", llm_type::LLM_TYPE_16B)
        .value("LLM_TYPE_20B", llm_type::LLM_TYPE_20B)
        .value("LLM_TYPE_30B", llm_type::LLM_TYPE_30B)
        .value("LLM_TYPE_32B", llm_type::LLM_TYPE_32B)
        .value("LLM_TYPE_34B", llm_type::LLM_TYPE_34B)
        .value("LLM_TYPE_35B", llm_type::LLM_TYPE_35B)
        .value("LLM_TYPE_40B", llm_type::LLM_TYPE_40B)
        .value("LLM_TYPE_65B", llm_type::LLM_TYPE_65B)
        .value("LLM_TYPE_70B", llm_type::LLM_TYPE_70B)
        .value("LLM_TYPE_236B", llm_type::LLM_TYPE_236B)
        .value("LLM_TYPE_314B", llm_type::LLM_TYPE_314B)
        .value("LLM_TYPE_671B", llm_type::LLM_TYPE_671B)
        .value("LLM_TYPE_SMALL", llm_type::LLM_TYPE_SMALL)
        .value("LLM_TYPE_MEDIUM", llm_type::LLM_TYPE_MEDIUM)
        .value("LLM_TYPE_LARGE", llm_type::LLM_TYPE_LARGE)
        .value("LLM_TYPE_XL", llm_type::LLM_TYPE_XL)
        .value("LLM_TYPE_A1_7B", llm_type::LLM_TYPE_A1_7B)
        .value("LLM_TYPE_A2_7B", llm_type::LLM_TYPE_A2_7B)
        .value("LLM_TYPE_8x7B", llm_type::LLM_TYPE_8x7B)
        .value("LLM_TYPE_8x22B", llm_type::LLM_TYPE_8x22B)
        .value("LLM_TYPE_16x12B", llm_type::LLM_TYPE_16x12B)
        .value("LLM_TYPE_16x3_8B", llm_type::LLM_TYPE_16x3_8B)
        .value("LLM_TYPE_10B_128x3_66B", llm_type::LLM_TYPE_10B_128x3_66B)
        .value("LLM_TYPE_57B_A14B", llm_type::LLM_TYPE_57B_A14B)
        .value("LLM_TYPE_27B", llm_type::LLM_TYPE_27B)
        .value("LLM_TYPE_290B", llm_type::LLM_TYPE_290B)
        .value("LLM_TYPE_17B_16E", llm_type::LLM_TYPE_17B_16E)
        .value("LLM_TYPE_17B_128E", llm_type::LLM_TYPE_17B_128E);

    py::class_<llama_layer_posnet>(m, "llama_layer_posnet")
        .def(py::init<>())
        .def_readwrite("norm1", &llama_layer_posnet::norm1)
        .def_readwrite("norm1_b", &llama_layer_posnet::norm1_b)
        .def_readwrite("conv1", &llama_layer_posnet::conv1)
        .def_readwrite("conv1_b", &llama_layer_posnet::conv1_b)
        .def_readwrite("norm2", &llama_layer_posnet::norm2)
        .def_readwrite("norm2_b", &llama_layer_posnet::norm2_b)
        .def_readwrite("conv2", &llama_layer_posnet::conv2)
        .def_readwrite("conv2_b", &llama_layer_posnet::conv2_b)
        .def_readwrite("attn_norm", &llama_layer_posnet::attn_norm)
        .def_readwrite("attn_norm_b", &llama_layer_posnet::attn_norm_b)
        .def_readwrite("attn_q", &llama_layer_posnet::attn_q)
        .def_readwrite("attn_q_b", &llama_layer_posnet::attn_q_b)
        .def_readwrite("attn_k", &llama_layer_posnet::attn_k)
        .def_readwrite("attn_k_b", &llama_layer_posnet::attn_k_b)
        .def_readwrite("attn_v", &llama_layer_posnet::attn_v)
        .def_readwrite("attn_v_b", &llama_layer_posnet::attn_v_b)
        .def_readwrite("attn_o", &llama_layer_posnet::attn_o)
        .def_readwrite("attn_o_b", &llama_layer_posnet::attn_o_b)
        .def_readwrite("norm", &llama_layer_posnet::norm)
        .def_readwrite("norm_b", &llama_layer_posnet::norm_b);

    py::class_<llama_layer_convnext>(m, "llama_layer_convnext")
        .def(py::init<>())
        .def_readwrite("dw", &llama_layer_convnext::dw)
        .def_readwrite("dw_b", &llama_layer_convnext::dw_b)
        .def_readwrite("norm", &llama_layer_convnext::norm)
        .def_readwrite("norm_b", &llama_layer_convnext::norm_b)
        .def_readwrite("pw1", &llama_layer_convnext::pw1)
        .def_readwrite("pw1_b", &llama_layer_convnext::pw1_b)
        .def_readwrite("pw2", &llama_layer_convnext::pw2)
        .def_readwrite("pw2_b", &llama_layer_convnext::pw2_b)
        .def_readwrite("gamma", &llama_layer_convnext::gamma);

    py::class_<llama_layer>(m, "llama_layer")
        .def(py::init<>())
        .def_readwrite("attn_norm", &llama_layer::attn_norm)
        .def_readwrite("attn_norm_b", &llama_layer::attn_norm_b)
        .def_readwrite("attn_norm_2", &llama_layer::attn_norm_2)
        .def_readwrite("attn_norm_2_b", &llama_layer::attn_norm_2_b)
        .def_readwrite("attn_q_norm", &llama_layer::attn_q_norm)
        .def_readwrite("attn_q_norm_b", &llama_layer::attn_q_norm_b)
        .def_readwrite("attn_k_norm", &llama_layer::attn_k_norm)
        .def_readwrite("attn_k_norm_b", &llama_layer::attn_k_norm_b)
        .def_readwrite("attn_out_norm", &llama_layer::attn_out_norm)
        .def_readwrite("attn_out_norm_b", &llama_layer::attn_out_norm_b)
        .def_readwrite("attn_q_a_norm", &llama_layer::attn_q_a_norm)
        .def_readwrite("attn_kv_a_norm", &llama_layer::attn_kv_a_norm)
        .def_readwrite("attn_sub_norm", &llama_layer::attn_sub_norm)
        .def_readwrite("attn_post_norm", &llama_layer::attn_post_norm)
        .def_readwrite("ffn_sub_norm", &llama_layer::ffn_sub_norm)
        .def_readwrite("attn_norm_cross", &llama_layer::attn_norm_cross)
        .def_readwrite("attn_norm_enc", &llama_layer::attn_norm_enc)
        .def_readwrite("wq", &llama_layer::wq)
        .def_readwrite("wk", &llama_layer::wk)
        .def_readwrite("wv", &llama_layer::wv)
        .def_readwrite("wo", &llama_layer::wo)
        .def_readwrite("wqkv", &llama_layer::wqkv)
        .def_readwrite("wq_a", &llama_layer::wq_a)
        .def_readwrite("wq_b", &llama_layer::wq_b)
        .def_readwrite("wkv_a_mqa", &llama_layer::wkv_a_mqa)
        .def_readwrite("wkv_b", &llama_layer::wkv_b)
        .def_readwrite("wq_cross", &llama_layer::wq_cross)
        .def_readwrite("wk_cross", &llama_layer::wk_cross)
        .def_readwrite("wv_cross", &llama_layer::wv_cross)
        .def_readwrite("wo_cross", &llama_layer::wo_cross)
        .def_readwrite("wq_enc", &llama_layer::wq_enc)
        .def_readwrite("wk_enc", &llama_layer::wk_enc)
        .def_readwrite("wv_enc", &llama_layer::wv_enc)
        .def_readwrite("wo_enc", &llama_layer::wo_enc)
        .def_readwrite("bq", &llama_layer::bq)
        .def_readwrite("bk", &llama_layer::bk)
        .def_readwrite("bv", &llama_layer::bv)
        .def_readwrite("bo", &llama_layer::bo)
        .def_readwrite("bqkv", &llama_layer::bqkv)
        .def_readwrite("attn_rel_b", &llama_layer::attn_rel_b)
        .def_readwrite("attn_rel_b_enc", &llama_layer::attn_rel_b_enc)
        .def_readwrite("attn_rel_b_cross", &llama_layer::attn_rel_b_cross)
        .def_readwrite("ffn_norm", &llama_layer::ffn_norm)
        .def_readwrite("ffn_norm_b", &llama_layer::ffn_norm_b)
        .def_readwrite("ffn_post_norm", &llama_layer::ffn_post_norm)
        .def_readwrite("layer_out_norm", &llama_layer::layer_out_norm)
        .def_readwrite("layer_out_norm_b", &llama_layer::layer_out_norm_b)
        .def_readwrite("ffn_norm_exps", &llama_layer::ffn_norm_exps)
        .def_readwrite("ffn_norm_enc", &llama_layer::ffn_norm_enc)
        .def_readwrite("ffn_gate", &llama_layer::ffn_gate)
        .def_readwrite("ffn_down", &llama_layer::ffn_down)
        .def_readwrite("ffn_up", &llama_layer::ffn_up)
        .def_readwrite("ffn_gate_enc", &llama_layer::ffn_gate_enc)
        .def_readwrite("ffn_down_enc", &llama_layer::ffn_down_enc)
        .def_readwrite("ffn_up_enc", &llama_layer::ffn_up_enc)
        .def_readwrite("ffn_gate_inp", &llama_layer::ffn_gate_inp)
        .def_readwrite("ffn_gate_exps", &llama_layer::ffn_gate_exps)
        .def_readwrite("ffn_down_exps", &llama_layer::ffn_down_exps)
        .def_readwrite("ffn_up_exps", &llama_layer::ffn_up_exps)
        .def_readwrite("ffn_gate_inp_shexp", &llama_layer::ffn_gate_inp_shexp)
        .def_readwrite("ffn_gate_shexp", &llama_layer::ffn_gate_shexp)
        .def_readwrite("ffn_down_shexp", &llama_layer::ffn_down_shexp)
        .def_readwrite("ffn_up_shexp", &llama_layer::ffn_up_shexp)
        .def_readwrite("ffn_gate_b", &llama_layer::ffn_gate_b)
        .def_readwrite("ffn_down_b", &llama_layer::ffn_down_b)
        .def_readwrite("ffn_up_b", &llama_layer::ffn_up_b)
        .def_readwrite("ffn_act", &llama_layer::ffn_act)
        .def_readwrite("ffn_exp_probs_b", &llama_layer::ffn_exp_probs_b)
        .def_readwrite("ssm_in", &llama_layer::ssm_in)
        .def_readwrite("ssm_x", &llama_layer::ssm_x)
        .def_readwrite("ssm_dt", &llama_layer::ssm_dt)
        .def_readwrite("ssm_out", &llama_layer::ssm_out)
        .def_readwrite("ssm_conv1d", &llama_layer::ssm_conv1d)
        .def_readwrite("ssm_a", &llama_layer::ssm_a)
        .def_readwrite("ssm_d", &llama_layer::ssm_d)
        .def_readwrite("ssm_conv1d_b", &llama_layer::ssm_conv1d_b)
        .def_readwrite("ssm_dt_b", &llama_layer::ssm_dt_b)
        .def_readwrite("time_mix_w1", &llama_layer::time_mix_w1)
        .def_readwrite("time_mix_w2", &llama_layer::time_mix_w2)
        .def_readwrite("time_mix_lerp_x", &llama_layer::time_mix_lerp_x)
        .def_readwrite("time_mix_lerp_w", &llama_layer::time_mix_lerp_w)
        .def_readwrite("time_mix_lerp_k", &llama_layer::time_mix_lerp_k)
        .def_readwrite("time_mix_lerp_v", &llama_layer::time_mix_lerp_v)
        .def_readwrite("time_mix_lerp_r", &llama_layer::time_mix_lerp_r)
        .def_readwrite("time_mix_lerp_g", &llama_layer::time_mix_lerp_g)
        .def_readwrite("time_mix_lerp_fused", &llama_layer::time_mix_lerp_fused)
        .def_readwrite("time_mix_first", &llama_layer::time_mix_first)
        .def_readwrite("time_mix_decay", &llama_layer::time_mix_decay)
        .def_readwrite("time_mix_decay_w1", &llama_layer::time_mix_decay_w1)
        .def_readwrite("time_mix_decay_w2", &llama_layer::time_mix_decay_w2)
        .def_readwrite("time_mix_key", &llama_layer::time_mix_key)
        .def_readwrite("time_mix_key_b", &llama_layer::time_mix_key_b)
        .def_readwrite("time_mix_value", &llama_layer::time_mix_value)
        .def_readwrite("time_mix_value_b", &llama_layer::time_mix_value_b)
        .def_readwrite("time_mix_receptance", &llama_layer::time_mix_receptance)
        .def_readwrite("time_mix_receptance_b", &llama_layer::time_mix_receptance_b)
        .def_readwrite("time_mix_gate", &llama_layer::time_mix_gate)
        .def_readwrite("time_mix_w0", &llama_layer::time_mix_w0)
        .def_readwrite("time_mix_a0", &llama_layer::time_mix_a0)
        .def_readwrite("time_mix_a1", &llama_layer::time_mix_a1)
        .def_readwrite("time_mix_a2", &llama_layer::time_mix_a2)
        .def_readwrite("time_mix_v0", &llama_layer::time_mix_v0)
        .def_readwrite("time_mix_v1", &llama_layer::time_mix_v1)
        .def_readwrite("time_mix_v2", &llama_layer::time_mix_v2)
        .def_readwrite("time_mix_g1", &llama_layer::time_mix_g1)
        .def_readwrite("time_mix_g2", &llama_layer::time_mix_g2)
        .def_readwrite("time_mix_k_k", &llama_layer::time_mix_k_k)
        .def_readwrite("time_mix_k_a", &llama_layer::time_mix_k_a)
        .def_readwrite("time_mix_r_k", &llama_layer::time_mix_r_k)
        .def_readwrite("time_mix_ln", &llama_layer::time_mix_ln)
        .def_readwrite("time_mix_ln_b", &llama_layer::time_mix_ln_b)
        .def_readwrite("time_mix_output", &llama_layer::time_mix_output)
        .def_readwrite("channel_mix_lerp_k", &llama_layer::channel_mix_lerp_k)
        .def_readwrite("channel_mix_lerp_r", &llama_layer::channel_mix_lerp_r)
        .def_readwrite("channel_mix_key", &llama_layer::channel_mix_key)
        .def_readwrite("channel_mix_receptance", &llama_layer::channel_mix_receptance)
        .def_readwrite("channel_mix_value", &llama_layer::channel_mix_value)
        .def_readwrite("rope_long", &llama_layer::rope_long)
        .def_readwrite("rope_short", &llama_layer::rope_short)
        .def_readwrite("rope_freqs", &llama_layer::rope_freqs)
        .def_readwrite("wq_scale", &llama_layer::wq_scale)
        .def_readwrite("wk_scale", &llama_layer::wk_scale)
        .def_readwrite("wv_scale", &llama_layer::wv_scale)
        .def_readwrite("wo_scale", &llama_layer::wo_scale)
        .def_readwrite("ffn_gate_scale", &llama_layer::ffn_gate_scale)
        .def_readwrite("ffn_up_scale", &llama_layer::ffn_up_scale)
        .def_readwrite("ffn_down_scale", &llama_layer::ffn_down_scale)
        .def_readwrite("posnet", &llama_layer::posnet)
        .def_readwrite("convnext", &llama_layer::convnext);

    py::class_<llama_model>(m, "llama_model")
        .def(py::init<>())
        .def_readwrite("type", &llama_model::type)
        .def_readwrite("arch", &llama_model::arch)
        .def_readwrite("hparams", &llama_model::hparams)
        .def_readwrite("vocab", &llama_model::vocab)
        .def_readwrite("tok_embd", &llama_model::tok_embd)
        .def_readwrite("type_embd", &llama_model::type_embd)
        .def_readwrite("pos_embd", &llama_model::pos_embd)
        .def_readwrite("tok_norm", &llama_model::tok_norm)
        .def_readwrite("tok_norm_b", &llama_model::tok_norm_b)
        .def_readwrite("output_norm", &llama_model::output_norm)
        .def_readwrite("output_norm_b", &llama_model::output_norm_b)
        .def_readwrite("output", &llama_model::output)
        .def_readwrite("output_b", &llama_model::output_b)
        .def_readwrite("output_norm_enc", &llama_model::output_norm_enc)
        .def_readwrite("cls", &llama_model::cls)
        .def_readwrite("cls_b", &llama_model::cls_b)
        .def_readwrite("cls_out", &llama_model::cls_out)
        .def_readwrite("cls_out_b", &llama_model::cls_out_b)
        .def_readwrite("conv1d", &llama_model::conv1d)
        .def_readwrite("conv1d_b", &llama_model::conv1d_b)
        .def_readwrite("params", &llama_model::params)
        .def_readwrite("t_load_us", &llama_model::t_load_us)
        .def_readwrite("t_start_us", &llama_model::t_start_us)
        .def_readwrite("llama_model", &llama_model::llama_model)
        .def_readwrite("load_stats", &llama_model::load_stats)
        .def_readwrite("load_arch", &llama_model::load_arch)
        .def_readwrite("load_hparams", &llama_model::load_hparams)
        .def_readwrite("load_vocab", &llama_model::load_vocab)
        .def_readwrite("load_tensors", &llama_model::load_tensors)
        .def_readwrite("size", &llama_model::size)
        .def_readwrite("n_tensors", &llama_model::n_tensors)
        .def_readwrite("n_devices", &llama_model::n_devices)
        .def_readwrite("n_elements", &llama_model::n_elements)
        .def_readwrite("print_info", &llama_model::print_info)
        .def_readwrite("dev_layer", &llama_model::dev_layer)
        .def_readwrite("dev_output", &llama_model::dev_output)
        .def_readwrite("select_buft", &llama_model::select_buft)
        .def_readwrite("has_tensor_overrides", &llama_model::has_tensor_overrides)
        .def_readwrite("get_tensor", &llama_model::get_tensor)
        .def_readwrite("create_memory", &llama_model::create_memory)
        .def_readwrite("build_graph", &llama_model::build_graph)
        .def_readwrite("private", &llama_model::private);

    m.def("llm_type_name", &llm_type_name);
}